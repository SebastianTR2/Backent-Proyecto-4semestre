@{
    ViewData["Title"] = "Simulador de Tarifas";
}

<div class="container mt-4">
    <h2 class="mb-4">Simulador de Tarifas</h2>
    
    <div class="row">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <form id="simForm">
                        <div class="mb-3">
                            <label class="form-label">ID Máquina</label>
                            <input type="text" id="machineId" class="form-control" required placeholder="ID de la máquina">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Hectáreas</label>
                            <input type="number" id="hectareas" class="form-control" placeholder="0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Toneladas</label>
                            <input type="number" id="toneladas" class="form-control" placeholder="0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Kilómetros (Transporte)</label>
                            <input type="number" id="km" class="form-control" placeholder="0">
                        </div>
                        <button type="button" class="btn btn-primary w-100" onclick="simulate()">Calcular</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm bg-light">
                <div class="card-body">
                    <h4>Resultados</h4>
                    <hr>
                    <p>Base (Día): <span id="resBase" class="fw-bold">0</span> Bs.</p>
                    <p>Hectáreas: <span id="resHec" class="fw-bold">0</span> Bs.</p>
                    <p>Toneladas: <span id="resTon" class="fw-bold">0</span> Bs.</p>
                    <p>Transporte: <span id="resKm" class="fw-bold">0</span> Bs.</p>
                    <hr>
                    <h3 class="text-success">Total: <span id="resTotal">0</span> Bs.</h3>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function simulate() {
            var data = {
                machineId: document.getElementById('machineId').value,
                hectareas: parseFloat(document.getElementById('hectareas').value) || 0,
                toneladas: parseFloat(document.getElementById('toneladas').value) || 0,
                km: parseFloat(document.getElementById('km').value) || 0
            };

            fetch('/ProviderMachines/Simulate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(res => res.json())
            .then(res => {
                document.getElementById('resBase').innerText = res.basePrice;
                document.getElementById('resHec').innerText = res.subtotalHectareas;
                document.getElementById('resTon').innerText = res.subtotalToneladas;
                document.getElementById('resKm').innerText = res.subtotalKm;
                document.getElementById('resTotal').innerText = res.total;
            })
            .catch(err => alert("Error al simular. Verifica el ID."));
        }
    </script>
}
