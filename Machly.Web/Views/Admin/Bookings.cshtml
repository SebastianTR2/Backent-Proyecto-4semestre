@model List<Machly.Web.Models.Admin.AdminBookingListItem>
@{
    ViewData["Title"] = "Reservas";
    var scope = (ViewData["Scope"]?.ToString() ?? "month").ToLowerInvariant();
    var from = ViewData["From"]?.ToString();
    var to = ViewData["To"]?.ToString();
    string FilterButtonClass(string value) => scope == value ? "btn btn-primary btn-sm" : "btn btn-outline-secondary btn-sm";
}

<div class="page-header">
    <div>
        <h1 class="page-title">Reservas</h1>
        <p class="page-subtitle">Historial de todas las reservas realizadas en la plataforma</p>
    </div>
</div>

<div class="card shadow-sm mb-4">
    <div class="card-body">
        <div class="d-flex flex-wrap gap-2 align-items-center mb-3">
            <span class="text-muted me-2">Rango rápido:</span>
            <a asp-action="Bookings" asp-route-scope="today" class="@FilterButtonClass("today")">Hoy</a>
            <a asp-action="Bookings" asp-route-scope="week" class="@FilterButtonClass("week")">Última semana</a>
            <a asp-action="Bookings" asp-route-scope="month" class="@FilterButtonClass("month")">Último mes</a>
            <a asp-action="Bookings" asp-route-scope="3m" class="@FilterButtonClass("3m")">3 meses</a>
            <a asp-action="Bookings" asp-route-scope="6m" class="@FilterButtonClass("6m")">6 meses</a>
            <a asp-action="Bookings" asp-route-scope="year" class="@FilterButtonClass("year")">1 año</a>
        </div>
        <form asp-action="Bookings" method="get" class="row g-3 align-items-end">
            <input type="hidden" name="scope" value="custom" />
            <div class="col-md-4">
                <label class="form-label">Desde</label>
                <input type="date" name="from" value="@from" class="form-control" />
            </div>
            <div class="col-md-4">
                <label class="form-label">Hasta</label>
                <input type="date" name="to" value="@to" class="form-control" />
            </div>
            <div class="col-md-4 d-flex gap-2">
                <button type="submit" class="btn btn-primary flex-grow-1">
                    <i class="fas fa-filter me-2"></i>Filtrar
                </button>
                <a asp-action="Bookings" class="btn btn-outline-secondary">
                    Limpiar
                </a>
            </div>
        </form>
    </div>
</div>

<div class="card shadow-sm">
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th>Máquina</th>
                    <th>Arrendatario</th>
                    <th>Inicio</th>
                    <th>Fin</th>
                    <th>Estado</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var booking in Model)
                {
                    <tr>
                        <td>@booking.MachineId</td>
                        <td>@booking.RenterId</td>
                        <td>@booking.Start.ToLocalTime().ToString("dd/MM/yyyy HH:mm")</td>
                        <td>@booking.End.ToLocalTime().ToString("dd/MM/yyyy HH:mm")</td>
                        <td>
                            <span class="badge bg-@(booking.Status == "CONFIRMED" ? "success" : booking.Status == "COMPLETED" ? "info" : "warning text-dark")">
                                @booking.Status
                            </span>
                        </td>
                        <td>Bs. @booking.TotalPrice.ToString("N2")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    @if (!Model.Any())
    {
        <div class="p-4 text-center text-muted">
            No se encontraron reservas para el rango seleccionado.
        </div>
    }
</div>

